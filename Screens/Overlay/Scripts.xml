<ActorFrame><children>

    <Layer
        Type="Quad"
        Name="Initialized"
        Condition="FUCK_EXE"
        OverlayReadyMessageCommand="queuecommand,First"
        FirstCommand="%function(self)
            if init then init=nil; return end init = true
            --
        end"
    />

    <Layer
        Type="Quad"
        Name="Screen Change"
        Condition="FUCK_EXE"
        OverlayReadyMessageCommand="queuecommand,First"
        FirstCommand="%function(self)
            if CONSTMELODY.Overlay.Last_Seen_Screen ~= '' then return end
            CONSTMELODY.Overlay.Last_Seen_Screen = 'Initialize' -- overlay is a pain
            self:luaeffect('Update')
        end"
        UpdateCommand="%function(self)
            if CONSTMELODY.Overlay.Last_Seen_Screen ~= SCREENMAN:GetTopScreen():GetName() then
                stitch('lua.event').Call('new screen',CONSTMELODY.Overlay.Last_Seen_Screen,SCREENMAN:GetTopScreen():GetName())
                CONSTMELODY.Overlay.Last_Seen_Screen = SCREENMAN:GetTopScreen():GetName()
            end
        end"
    />

    <Layer
        Type="Quad"
        Name="ScreenEdit State"
        Condition="CONSTMELODY.MinimumVersion('V3')"
        OverlayReadyMessageCommand="queuecommand,First"
        FirstCommand="%function(self)
            if SCREENEDIT then SCREENEDIT=nil; return end SCREENEDIT = true
            self:luaeffect('Update')
        end"
        UpdateCommand="%function(self)
            if SCREENMAN:GetTopScreen():GetName() == 'ScreenEdit' then
                local isInGameMode = (SCREENMAN:GetTopScreen():GetChild('SongForeground'):GetNumChildren() > 0)
                if CONSTMELODY.IsEditPlaying ~= isInGameMode then
                    CONSTMELODY.IsEditPlaying = isInGameMode
                    stitch('lua.event').Call('screenedit state', isInGameMode)
                end
            end
        end"
    />

</children></ActorFrame>